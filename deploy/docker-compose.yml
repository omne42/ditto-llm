services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  gateway:
    build:
      context: ..
      dockerfile: Dockerfile
    depends_on:
      - redis
    env_file:
      - .env
    volumes:
      - ./gateway.example.json:/config/gateway.json:ro
    ports:
      - "8080:8080"
    command:
      - /config/gateway.json
      - --listen
      - 0.0.0.0:8080
      - --redis-env
      - REDIS_URL
      - --redis-prefix
      - ditto
      - --admin-token-env
      - DITTO_ADMIN_TOKEN
      - --proxy-max-in-flight
      - "256"
      - --proxy-cache
      - --proxy-cache-ttl
      - "60"
      - --proxy-cache-max-entries
      - "2048"
      - --proxy-cache-max-body-bytes
      - "1048576"
      - --proxy-cache-max-total-body-bytes
      - "67108864"
      - --json-logs
